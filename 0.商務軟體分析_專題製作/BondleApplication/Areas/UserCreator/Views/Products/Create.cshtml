@model BondleApplication.Models.Product

@{
    ViewData["Title"] = "新增商品";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
           
            <h2>@ViewData["Title"]</h2>
        </div>
    </div>

    <form asp-action="Create" id="mainProductForm">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

        <div class="row">
            <!-- 主要產品資訊 -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>基本資訊</h4>
                    </div>
                    <div class="card-body">
                        <div class="form-group mb-3">
                            <label asp-for="ProductName" class="form-label"></label>
                            <input asp-for="ProductName" class="form-control" />
                            <span asp-validation-for="ProductName" class="text-danger"></span>
                        </div>       
                        <div class="form-group mb-3">
                            <label asp-for="Description" class="form-label"></label>
                            <textarea asp-for="Description" class="form-control" rows="3"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label asp-for="Price" class="form-label"></label>
                                    <input asp-for="Price" class="form-control" type="number"  />
                                    <span asp-validation-for="Price" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label asp-for="CategoryID" class="form-label"></label>
                                    <select asp-for="CategoryID" class="form-control" asp-items="ViewBag.CategoryList" ></select>
                                    <span asp-validation-for="CategoryID" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 產品圖片 -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>產品圖片</h4>
                    </div>
                    <div class="card-body" id="productImagesContainer">
                        <div class="alert alert-info">
                            <small>請先設定商品款式後再上傳商品圖片</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="row">
            <div class="col-12">
                <ul class="nav nav-tabs" id="productTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="digital-tab" data-bs-toggle="tab" data-bs-target="#digital" type="button" role="tab">
                            數位產品
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="physical-tab" data-bs-toggle="tab" data-bs-target="#physical" type="button" role="tab">
                            實體產品
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="variations-tab" data-bs-toggle="tab" data-bs-target="#variations" type="button" role="tab">
                            產品款式
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="series-tab" data-bs-toggle="tab" data-bs-target="#series" type="button" role="tab">
                            產品系列
                        </button>
                    </li>
                </ul>

                <div class="tab-content mt-3" id="productTabContent">
                    <div class="tab-pane fade show active" id="digital" role="tabpanel">
                        <div id="digitalProductContainer">
                            <div class="alert alert-info">
                                <small>請先儲存產品基本資訊後載入數位商品設定</small>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="physical" role="tabpanel">
                        <div id="physicalProductContainer">
                            <div class="alert alert-info">
                                <small>請先儲存產品基本資訊後載入實體商品設定</small>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="variations" role="tabpanel">
                        <div id="variationsContainer">
                            <div class="alert alert-info">
                                <small>請先儲存產品基本資訊後載入商品款式設定</small>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="series" role="tabpanel">
                        <div id="seriesContainer">
                            <div class="alert alert-info">
                                <small>請先儲存產品基本資訊後載入產品系列設定</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <button type="submit" class="btn btn-primary me-2">儲存產品</button>
                <a asp-action="Index" class="btn btn-secondary">取消</a>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            let currentProductId = null;

            // 主要產品表單提交
            $('#mainProductForm').on('submit', function(e) {
                e.preventDefault();

                $.post($(this).attr('action'), $(this).serialize())
                .done(function(data) {
                    if (data.success || data.id) {
                        currentProductId = data.id || data.productId;
                        toastr.success('產品基本資訊已儲存');
                        loadSubForms();
                    } else {
                        toastr.error('儲存失敗');
                    }
                })
                .fail(function() {
                    toastr.error('發生錯誤，請稍後再試');
                });
            });

            function loadSubForms() {
                if (!currentProductId) return;

                // 載入數位產品表單
                $('#digitalProductContainer').load(`/DigitalProduct/GetByProductId/${currentProductId}`);

                // 載入實體產品表單
                $('#physicalProductContainer').load(`/PhysicalProduct/GetByProductId/${currentProductId}`);

                // 載入產品款式表單
                $('#variationsContainer').load(`/ProductVariation/GetByProductId/${currentProductId}`);

                // 載入產品系列表單
                $('#seriesContainer').load(`/ProSeries/GetByProductId/${currentProductId}`);

                // 載入產品圖片表單
                $('#productImagesContainer').load(`/ProductImage/GetByVariationId/${currentVariationId}`);
            }

            // Tab 點擊事件
            $('button[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
                if (currentProductId) {
                    const target = $(e.target).data('bs-target');
                    if (!$(target + ' form').length) {
                        loadSubForms();
                    }
                }
            });
        });
    </script>
}




@* <h1>Create</h1>

<h4>Product</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Create">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label asp-for="ProductID" class="control-label"></label>
                <input asp-for="ProductID" class="form-control" />
                <span asp-validation-for="ProductID" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="ProductType" class="control-label"></label>
                <input asp-for="ProductType" class="form-control" />
                <span asp-validation-for="ProductType" class="text-danger"></span>
            </div>
          

            <div class="form-group">
                <label asp-for="LaunchDate" class="control-label"></label>
                <input asp-for="LaunchDate" class="form-control" />
                <span asp-validation-for="LaunchDate" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="OfflineDate" class="control-label"></label>
                <input asp-for="OfflineDate" class="form-control" />
                <span asp-validation-for="OfflineDate" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="SortOrder" class="control-label"></label>
                <input asp-for="SortOrder" class="form-control" />
                <span asp-validation-for="SortOrder" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="PurchaseCount" class="control-label"></label>
                <input asp-for="PurchaseCount" class="form-control" />
                <span asp-validation-for="PurchaseCount" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="CreatorID" class="control-label"></label>
                <select asp-for="CreatorID" class ="form-control" asp-items="ViewBag.CreatorID"></select>
            </div>
            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div> *@

